<!DOCTYPE html>
<html>
<head>
    <title>Product List</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Function to fetch product variations and display them
            function getProductVariations(productId) {
                var currentDomain = window.location.origin;
                var url = currentDomain + "/products/variations/" + productId;
                $.ajax({
                    url: url,
                    type: "GET",
                    success: function(data) {
                        var variations = data.variations;
                        var variationsList = "<ul>";
                        for (var i = 0; i < variations.length; i++) {
                            variationsList += "<li>Price: " + variations[i].price.toFixed(2) + " - Supermarket: " + variations[i].supermarket.name + "</li>";
                        }
                        variationsList += "</ul>";
                        $("#variations").html(variationsList);
                    },
                    error: function() {
                        alert("Error retrieving variations.");
                    }
                });
            }

            // Function to fetch products and display them
            function getProducts(categoryId, searchKey) {
                var currentDomain = window.location.origin;
                var url = currentDomain + "/products";
                if (categoryId !== 0) {
                    url += "/categories/" + categoryId;
                }
                if (searchKey) {
                    url += "?search=" + encodeURIComponent(searchKey);
                }
                $.ajax({
                    url: url,
                    type: "GET",
                    success: function(data) {
                        var products = data.products;
                        var productList = "<ul>";
                        for (var i = 0; i < products.length; i++) {
                            productList += '<li><a href="#" class="product-link" data-id="' + products[i].ID + '">' + products[i].name + ' - ' + products[i].brand + '</a></li>';
                        }
                        productList += "</ul>";
                        $("#products").html(productList);

                        // Add click event listener to product links
                        $(".product-link").click(function(e) {
                            e.preventDefault();
                            var productId = $(this).data("id");
                            getProductVariations(productId);
                        });
                    },
                    error: function() {
                        alert("Error retrieving products.");
                    }
                });
            }

            // Fetch and display all products
            getProducts(0);

            // Category button click event
            $(".category-btn").click(function() {
                var categoryId = $(this).data("category-id");
                getProducts(categoryId);
            });

            // Search button click event
            $("#search-btn").click(function() {
                var searchKey = $("#search-input").val();
                getProducts(0, searchKey);
            });
        });
    </script>
</head>
<body>
    <h1>Product List</h1>
    <div>
        <input type="text" id="search-input" placeholder="Enter search key">
        <button id="search-btn">Search</button>
    </div>
    <br>
    <div>
        <button class="category-btn" data-category-id="0">All categories</button>
        <button class="category-btn" data-category-id="1">Drinks</button>
        <button class="category-btn" data-category-id="2">Vegetables</button>
        <button class="category-btn" data-category-id="3">Meats</button>
    </div>
    <div id="products"></div>
    <h2>Variations</h2>
    <div id="variations"></div>
</body>
</html>
